<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Form</title>
    <style>
        /* Add styles for table and modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            margin: 10% auto;
            width: 60%;
        }
    </style>
</head>
<body>
    <div id="form-container"></div>

    <!-- Modal for adding table entries -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <form id="entry-form">
                <h3>Add Entry</h3>
                <div id="modal-fields"></div>
                <button type="submit">Save Entry</button>
                <button type="button" onclick="closeModal()">Close</button>
            </form>
        </div>
    </div>

    <script>
        // Fetch form data from backend
        fetch('http://localhost:5000/api/formbuilde')
            .then(response => response.json())
            .then(data => renderForm(data));

        function renderForm(data) {
            const formContainer = document.getElementById('form-container');
            
            data.sections.forEach(section => {
                const sectionElement = document.createElement('div');
                sectionElement.classList.add('section');
                
                // Section title
                const sectionTitle = document.createElement('h2');
                sectionTitle.innerText = section.title;
                sectionElement.appendChild(sectionTitle);
                
                // Table for each section
                const table = document.createElement('table');
                const tableHeader = document.createElement('tr');
                section.fields.forEach(field => {
                    const th = document.createElement('th');
                    th.innerText = field.label;
                    tableHeader.appendChild(th);
                });
                table.appendChild(tableHeader);
                
                // Add rows for table
                section.fields.forEach(field => {
                    const row = document.createElement('tr');
                    section.fields.forEach(() => {
                        const td = document.createElement('td');
                        td.innerText = "Data";  // Replace with dynamic data if available
                        row.appendChild(td);
                    });
                    table.appendChild(row);
                });
                
                sectionElement.appendChild(table);
                
                // Add Button to open modal
                const addButton = document.createElement('button');
                addButton.innerText = 'Add Entry';
                addButton.onclick = () => openModal(section.fields);
                sectionElement.appendChild(addButton);
                
                formContainer.appendChild(sectionElement);
            });
        }

        // Open modal to add data to table
        function openModal(fields) {
            const modal = document.getElementById('modal');
            const modalFields = document.getElementById('modal-fields');
            modalFields.innerHTML = ''; // Clear existing fields
            
            fields.forEach(field => {
                const label = document.createElement('label');
                label.innerText = field.label;
                
                let input;
                if (field.type === 'text') {
                    input = document.createElement('input');
                    input.type = 'text';
                } else if (field.type === 'dropdown') {
                    input = document.createElement('select');
                    field.options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.innerText = option;
                        input.appendChild(optionElement);
                    });
                }
                
                const div = document.createElement('div');
                div.appendChild(label);
                div.appendChild(input);
                modalFields.appendChild(div);
            });
            
            modal.style.display = 'block';
        }

        // Close modal
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Handle form submission to add entry
        document.getElementById('entry-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const entry = {};
            formData.forEach((value, key) => {
                entry[key] = value;
            });
            console.log(entry); // Handle submission to the backend
            closeModal();
        });
    </script>
</body>
</html>
